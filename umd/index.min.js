!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.butterflyTemplate=e():t.butterflyTemplate=e()}(window,function(){return function(t){var e={};function i(n){if(e[n])return e[n].exports;var s=e[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,i),s.l=!0,s.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)i.d(n,s,function(e){return t[e]}.bind(null,s));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e){function i(t){return document.createElement(t)}function n(t){return document.createTextNode(t)}function s(t,e){for(lhs in e)t.setAttribute(lhs,e[lhs])}function r(){}class h{lex(t){for(this.text=t,this.index=0,this.currentLineNumber=1,this.tokens=[],this.relationsMap=[],this.parsingMode=null,this.contextMode=null,this.tagR1=/[a-zA-Z]/,this.tagR2=/-|\d/,this.whiteSpaceR=/\s/,this.escapeChars={b:"\b",f:"\f",n:"\n",r:"\r",t:"\t",v:"\v","'":"'",'"':'"'};this.index<this.text.length;){let e=t[this.index];if(this.tagR1.test(e))this.parsingMode=i,this.tokens.push(this.readTag());else if(this.whiteSpaceR.test(e))"\n"===e&&(this.currentLineNumber+=1),this.index+=1;else if("["===e){if(!this.tokens.length)throw this.vizError(this.index,this.index+1),new Error(`Can not declare children without a parent: line ${this.currentLineNumber}, index ${this.index}, char ${this.text[this.index]}`);this.relationsMap.push(this.tokens[this.tokens.length-1]),this.contextMode=r,this.index+=1}else if("]"===e)this.relationsMap.pop(),this.contextMode=this.relationsMap.length?r:null,this.index+=1;else if("'"===e||'"'===e)this.parsingMode=n,this.tokens.push(this.readText(e));else if("("===e){if(!this.tokens.length)throw this.vizError(this.index,this.index+1),new Error(`Can not attach attrs on null: line ${this.currentLineNumber}, index ${this.index}, char ${this.text[this.index]}`);this.parsingMode=s,this.tokens[this.tokens.length-1].attrs=this.readAttrs()}else{if(","!==e)throw this.vizError(this.index,this.index+1),new Error(`Unknown char: line ${this.currentLineNumber}, index ${this.index}, char ${this.text[this.index]}`);this.index+=1}}return this.tokens}readTag(){let t="",e=this.index;for(t+=this.text[this.index],this.index+=1;this.parsingMode===i;){let i=this.text[this.index];if(null==i||!this.tagR1.test(i)&&!this.tagR2.test(i)){let i=this.makeToken(t,e);return t=e=null,i}t+=i,this.index+=1}}readText(t){let e="",i=t,s=this.index+1,r=!1;for(this.index+=1;this.parsingMode===n;){let t=this.text[this.index];if(null==t)throw this.vizError(s,this.index-1),new Error(`Missing quote: line ${this.currentLineNumber}, index ${this.index}, text ${this.text.slice(s,this.index-1)}`);if(r)e+=this.escapeChars[this.text[this.index]]||t,this.index+=1,r=!1;else if("\\"===t)r=!0,this.index+=1;else{if(t===i){let t=this.makeToken(e,s);return e=s=null,this.index+=1,t}"\n"===t&&(this.currentLineNumber+=1),e+=t,this.index+=1}}}readAttrs(){let t={},e="",i="",r=!0,h=!1,o=!1,l=this.index+1;for(this.index+=1;this.parsingMode===s;){let a=this.text[this.index];if(null==a)throw this.vizError(l,this.index),new Error(`Missing a closing parenthesis: ${this.componentName?"Component "+this.componentName+",":""} text ${this.text.slice(l,this.index)}`);if(this.whiteSpaceR.test(a))e&&(o=!0),"\n"===a&&(this.currentLineNumber+=1),this.index+=1;else if(","===a||")"===a){if(e&&(t[e]=i),e=i="",h=!1,r=!0,o=!1,this.index+=1,")"===a){let n=this.makeToken(t,l);return this.parsingMode=e=i=t=null,n}}else if(r)if(this.tagR1.test(a)||e.length&&this.tagR2.test(a)){if(o)throw this.vizError(l,this.index),new Error(`Missing a comma: ${this.componentName?"Component -> "+this.componentName+",":""} text -> ${this.text.slice(l,this.index)}`);e+=a,this.index+=1}else{if("="!==a)throw this.vizError(this.index,this.index+1),new Error(`Attr keys must not have quotes or invalid chars: line -> ${this.currentLineNumber}, index -> ${this.index}, char -> ${this.text[this.index]}`);h=!0,r=!1,o=!1,this.index+=1}else if(h){if("'"!==a&&'"'!==a)throw this.vizError(this.index,this.index+1),new Error(`Attr values must have quotes: line -> ${this.currentLineNumber}, index -> ${this.index}, char -> ${this.text[this.index]}`);this.parsingMode=n,i=this.readText(a).rawValue,h=!1,r=!1,o=!0,this.parsingMode=s}else if(o)throw this.vizError(l,this.index),new Error(`Missing a comma: ${this.componentName?"Component -> "+this.componentName+",":""} text -> ${this.text.slice(l,this.index)}`)}}makeToken(t,e){let i={parsingMode:this.parsingMode,contextMode:this.contextMode,rawValue:t,startIndex:e,endIndex:this.index-1,lineNumber:this.currentLineNumber,parentToken:this.contextMode===r?this.relationsMap[this.relationsMap.length-1]:null,attrs:null};return this.parsingMode=null,i}vizError(t,e){let i;if("object"==typeof document&&(i=document.querySelector("body"))){let n=`<pre>${this.text.slice(0,t)}<b style="color:orangered">${this.text.slice(t,e)}</b></pre>`;i.innerHTML=n}}}class o{build(t=[]){if(this.tokens=t,this.vnt=[],this.tokensLength=this.tokens.length,this.tokensLength>0)return this.tokens.forEach(t=>{if(t.parentToken){let e=t.parentToken.children;e?e.push(t):t.parentToken.children=[t]}else this.vnt.push(t)}),this.vnt.length>1?this.vnt:this.vnt[0];throw new Error("VNT Error: not enough tokens")}compile(t){return"[object Object]"===Object.prototype.toString.call(t)?this._compile(t):"[object Array]"===Object.prototype.toString.call(t)?t.map(t=>this._compile(t)):void 0}_compile({rawValue:t,attrs:e,children:i,parsingMode:n}){var r=n(t);return e&&s(r,e.rawValue),i&&i.forEach(t=>{r.append(this._compile(t))}),r}}t.exports={Lexer:h,VNT:o,templateToDOM:function(){let t=new h,e=new o;return function(i){return e.compile(e.build(t.lex(i)))}}()}}])});